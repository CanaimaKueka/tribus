{% extends 'auth/base.html' %}
{% load i18n %}
{% block title %}Login{% endblock %}
{% block content %}
<div class="well jumbotron">
	<div class="login-container">
		<h3 class="lighter block blue">Sign in to Tribus</h3>
		<hr />
		<p>Después de introducir sus datos de usuario, usted podrá editar su información de perfil.</p>
		{% if error_title %}
		<div class="alert alert-error">
			<strong>
				<i class="icon-remove"></i>Oh snap! {{ error_title }}
			</strong>
			{% if form.non_field_errors %}
        		{% for non_field_error in form.non_field_errors %}
        			<p>{{ non_field_error }}</p>
        		{% endfor %}
			{% endif %}

			{% for field in form %}
				{% if field.errors %}
					{% for error in field.errors %}
        				<p>{{ error }}</p>
        			{% endfor %}
        		{% endif %}
		    {% endfor %}
		</div>
		{% endif %}
		<form method="post" action="{% url 'auth_login' %}">
            {% csrf_token %}
            <ul class="unstyled">
				{% for field in form %}
        			<li>
            		{{ field.label_tag }} {{ field }}
        			</li>
    			{% endfor %}
            </ul>
			<button class="btn btn-yellow btn-block" type="submit">Log in</button>
			<input type="hidden" name="next" value="{{ next }}" />
		</form>
		<ul class="unstyled">
			<li><a href="{% url 'auth_password_reset' %}">forgot your password?</a></li>
			<li><a href="{% url 'auth_signup' %}">are you new to Tribus?</a></li>
		</ul>
	</div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
			$(function() {
			
				$('[data-rel=tooltip]').tooltip();
			
				$(".chzn-select").css('width','150px').chosen({allow_single_deselect:true , no_results_text: "No such state!"})
				.on('change', function(){
					$(this).closest('form').validate().element($(this));
				}); 
			
			
				var $validation = false;
				$('#fuelux-wizard').ace_wizard().on('change' , function(e, info){
					if(info.step == 1 && $validation) {
						if(!$('#validation-form').valid()) return false;
					}
				}).on('finished', function(e) {
					bootbox.dialog("Thank you! Your information was successfully saved!", [{
						"label" : "OK",
						"class" : "btn-small btn-primary",
						}]
					);
				});
			
			
				$('#validation-form').hide();
				$('#skip-validation').removeAttr('checked').on('click', function(){
					$validation = this.checked;
					if(this.checked) {
						$('#sample-form').hide();
						$('#validation-form').show();
					}
					else {
						$('#validation-form').hide();
						$('#sample-form').show();
					}
				});
			
			
			
				//documentation : http://docs.jquery.com/Plugins/Validation/validate
			
			
				$.mask.definitions['~']='[+-]';
				$('#phone').mask('(999) 999-9999');
			
				jQuery.validator.addMethod("phone", function (value, element) {
					return this.optional(element) || /^\(\d{3}\) \d{3}\-\d{4}( x\d{1,6})?$/.test(value);
				}, "Enter a valid phone number.");
			
				$('#validation-form').validate({
					errorElement: 'span',
					errorClass: 'help-inline',
					focusInvalid: false,
					rules: {
						email: {
							required: true,
							email:true
						},
						password: {
							required: true,
							minlength: 5
						},
						password2: {
							required: true,
							minlength: 5,
							equalTo: "#password"
						},
						name: {
							required: true
						},
						phone: {
							required: true,
							phone: 'required'
						},
						url: {
							required: true,
							url: true
						},
						comment: {
							required: true
						},
						state: {
							required: true
						},
						platform: {
							required: true
						},
						subscription: {
							required: true
						},
						gender: 'required',
						agree: 'required'
					},
			
					messages: {
						email: {
							required: "Please provide a valid email.",
							email: "Please provide a valid email."
						},
						password: {
							required: "Please specify a password.",
							minlength: "Please specify a secure password."
						},
						subscription: "Please choose at least one option",
						gender: "Please choose gender",
						agree: "Please accept our policy"
					},
			
					invalidHandler: function (event, validator) { //display error alert on form submit   
						$('.alert-error', $('.login-form')).show();
					},
			
					highlight: function (e) {
						$(e).closest('.control-group').removeClass('info').addClass('error');
					},
			
					success: function (e) {
						$(e).closest('.control-group').removeClass('error').addClass('info');
						$(e).remove();
					},
			
					errorPlacement: function (error, element) {
						if(element.is(':checkbox') || element.is(':radio')) {
							var controls = element.closest('.controls');
							if(controls.find(':checkbox,:radio').length > 1) controls.append(error);
							else error.insertAfter(element.nextAll('.lbl').eq(0));
						} 
						else if(element.is('.chzn-select')) {
							error.insertAfter(element.nextAll('[class*="chzn-container"]').eq(0));
						}
						else error.insertAfter(element);
					},
			
					submitHandler: function (form) {
					},
					invalidHandler: function (form) {
					}
				});
			
			})
		</script>
{% endblock %}
