{% load i18n %}
<div data-ng-controller="TribController" data-ng-init="addOldTribs();pollNewTribs()">
    <div class="action_publisher">
        <div class="row-fluid">
            <form autocomplete="off" name="action_form" data-ng-submit="createNewTrib()">
                <span class="span1">
                    <span class="action_avatar" data-ng-style="{'background-image': 'url(\''+user_gravatar+'?d=mm&s=50&r=x\')'}"></span>
                </span>
                <span class="span9 action_body">
                    <span class="arrow_left"></span>
                    <span class="action_bubble">
                        <textarea id="id_trib_content" class="action_textarea autosize expand" cols="40" rows="10" name="trib_content" data-ng-model="trib_content" placeholder="{% blocktrans %}What are you doing?{% endblocktrans %}"></textarea>
                        <span class="action_validation">200</span>
                    </span>
                </span>
                <span class="span2 action_submit">
                    <button class="btn btn-success action_button" disabled="disabled">
                        <i class="icon-pencil"></i>
                        {% trans 'Publish' %}
                    </button>
                </span>
            </form>
        </div>
    </div>
    <div growl></div>
    <div class="trib_list" infinite-scroll="addOldTribs()" infinite-scroll-disabled="controller_busy" infinite-scroll-distance="0">
        <ul>
            <li id="{% verbatim %}{{ trib.id }}{% endverbatim %}" class="row-fluid trib_item"
                data-ng-repeat="trib in tribs | orderBy: trib_orderby | limitTo: trib_limit_to track by trib.id">
                <span class="span2">
                    <span class="trib_avatar" data-ng-style="{'background-image': 'url(\''+trib.author_gravatar+'\')'}"></span>
                </span>
                <span class="arrow_left"></span>
                <span class="span10 trib_body">
                    <span class="trib_title">
                        <h3>
                            <a href="/profile/{% verbatim %}{{ trib.author_username }}{% endverbatim %}">
                                {% verbatim %}
                                {{ trib.author_first_name }} {{ trib.author_last_name }}
                                {% endverbatim %}
                            </a>
                        </h3>
                        <h4>{% verbatim %}@{{ trib.author_username }}{% endverbatim %}</h4>
                        <h4 class="timeago pull-right" title="{% verbatim %}{{ trib.trib_pub_date }}{% endverbatim %}"></h4>
                    </span>
                    <span class="trib_content">{% verbatim %}{{ trib.trib_content }}{% endverbatim %}</span>
                    <span class="trib_interact">
                        <span class="pull-right" data-ng-click="toggleTrib()">
                            <a href=""><span class="icon-chevron-down"></span>{% trans 'Comment' %}</a>
                        </span>
                        <span data-ng-if="trib.author_id != {{ user.id }}" data-ng-click="shareTrib()" class="pull-right">
                            <a href=""><span class="icon-bullhorn"></span>{% trans 'Share' %}</a>
                        </span>
                        <span data-ng-if="trib.author_id != {{ user.id }}" data-ng-click="favTrib()" class="pull-right">
                            <a href=""><span class="icon-star-empty"></span>{% trans 'Favorite' %}</a>
                        </span>
                        <span data-ng-if="trib.author_id != {{ user.id }}" data-ng-click="dislikeTrib()" class="pull-right">
                            <a href=""><span class="icon-thumbs-down-alt"></span>{% trans 'Dislike' %}</a>
                        </span>
                        <span data-ng-if="trib.author_id != {{ user.id }}" data-ng-click="likeTrib()" class="pull-right">
                            <a href=""><span class="icon-thumbs-up-alt"></span>{% trans 'Like' %}</a>
                        </span>
                        <span data-ng-if="trib.author_id == {{ user.id }}" data-ng-click="configDeleteTrib()"
                            data-target="#delete_trib_modal" data-toggle="modal" role="button">
                            <a href=""><span class="icon-trash"></span>{% trans 'Delete' %}</a>
                        </span>
                    </span>
                    <span class="trib_reply">
                        <span class="comment_list" data-ng-controller="CommentController" data-ng-if="trib.reply_show"
                            data-ng-init="this.trib_id = trib.id;addNewComments();">
                            <ul>
                                <li data-ng-if="comments.length > 0" class="row-fluid comment_item">
                                    <button class="btn btn-beige btn-block btn-mini" data-ng-click="addOldComments()">
                                        {% trans 'Load more comments' %}
                                    </button>
                                </li>
                                <li id="{% verbatim %}{{ comment.id }}{% endverbatim %}" class="row-fluid comment_item"
                                    data-ng-repeat="comment in comments | orderBy: comment_orderby | limitTo: comment_limit_to track by comment.id">
                                    <span class="span1">
                                        <span class="comment_avatar"></span>
                                    </span>
                                    <span class="span11 comment_body">
                                        <span class="comment_text">
                                            <h3>
                                                <a href="/profile/{% verbatim %}{{ comment.author_username }}{% endverbatim %}">
                                                    {% verbatim %}
                                                    {{ comment.author_first_name }} {{ comment.author_last_name }}
                                                    {% endverbatim %}
                                                </a>
                                            </h3>
                                            {% verbatim %}{{ comment.comment_content }}{% endverbatim %}
                                        </span>
                                        <span data-ng-if="comment.author_id == {{ user.id }}" class="close"
                                        data-ng-click="configDeleteComment()" data-target="#delete_comment_modal"
                                        data-toggle="modal" role="button">
                                            <span class="icon-remove"></span>
                                        </span>
                                        <span class="comment_date">
                                            <h4 class="timeago" title="{% verbatim %}{{ comment.comment_pub_date }}{% endverbatim %}"></h4>
                                        </span>
                                    </span>
                                </li>
                                <li class="comment_box">
                                    <form data-ng-submit="createNewComment()">
                                        <span class="span1">
                                            <span class="comment_avatar" data-ng-style="{'background-image': 'url(\''+comment_gravatar+'\')'}"></span>
                                        </span>
                                        <span class="span9 comment_body">
                                            <span class="arrow_left"></span>
                                            <span class="comment_bubble">
                                                <textarea data-ng-model="comment_content" rows="1" class="comment_textarea autosize expand" placeholder="{% blocktrans %}What do you want to say?{% endblocktrans %}"></textarea>
                                            </span>
                                        </span>
                                        <span class="span2">
                                            <button class="btn btn-success btn-xs comment_button" disabled="disabled">
                                                {% trans 'Comment' %}
                                            </button>
                                        </span>
                                    </form>
                                </li>
                            </ul>
                            <div id="delete_comment_modal" class="modal hide fade" tabindex="-1" role="dialog">
                                <div class="modal-body">
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span class="icon-remove"></span>
                                    </button>
                                    <h4>{% trans 'Are you sure you want to delete this comment?' %}</h4>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn" data-dismiss="modal">
                                        {% trans 'Cancel' %}
                                    </button>
                                    <button class="btn btn-success" data-dismiss="modal" data-ng-click="deleteComment(delete_comment_id)">
                                        {% trans 'Delete comment' %}
                                    </button>
                                </div>
                            </div>
                        </span>
                    </span>
                </span>
            </li>
        </ul>
    </div>
    <div id="delete_trib_modal" class="modal hide fade" tabindex="-1" role="dialog">
        <div class="modal-body">
            <button type="button" class="close" data-dismiss="modal">
                <span class="icon-remove"></span>
            </button>
            <h4>{% trans 'Are you sure you want to delete this message?' %}</h4>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal">
                {% trans 'Cancel' %}
            </button>
            <button class="btn btn-success" data-dismiss="modal" data-ng-click="deleteTrib(delete_trib_id)">
                {% trans 'Delete message' %}
            </button>
        </div>
    </div>
</div>